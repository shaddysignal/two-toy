/**
 * two.js
 * a two-dimensional drawing api meant for modern browsers. It is renderer 
 * agnostic enabling the same api for rendering in multiple contexts: webgl, 
 * canvas2d, and svg.
 *
 * Copyright (c) 2012 - 2013 jonobr1 / http://jonobr1.com
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 */
//     Underscore.js 1.5.1
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.
(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.5.1";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?void 0:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t==null?x.identity:t);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return t&&x.every(e,x.isArray)?a.apply(n,e):(T(e,function(e){x.isArray(e)||x.isArguments(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n)};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e);for(var n=0;n<e;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(S&&e.bind===S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:new Date,o=null,s=e.apply(r,i)};return function(){var f=new Date;!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0?(clearTimeout(o),o=null,u=f,s=e.apply(r,i)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},x.debounce=function(e,t,n){var r,i=null;return function(){var s=this,o=arguments,u=function(){i=null,n||(r=e.apply(s,o))},a=n&&!i;return clearTimeout(i),i=setTimeout(u,t),a&&(r=e.apply(s,o)),r}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var a=0,l=!0;if(i=="[object Array]"){a=e.length,l=a==t.length;if(l)while(a--)if(!(l=M(e[a],t[a],n,r)))break}else{for(var c in e)if(x.has(e,c)){a++;if(!(l=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(l){for(c in t)if(x.has(t,c)&&!(a--))break;l=!a}}return n.pop(),r.pop(),l};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(Math.max(0,e));for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);var Backbone=Backbone||{};(function(){var e=[],t=e.slice,n=/\s+/,r=function(e,t,n){var r,i=-1,s=t.length;switch(n.length){case 0:while(++i<s)(r=t[i]).callback.call(r.ctx);return;case 1:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0]);return;case 2:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0],n[1]);return;case 3:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0],n[1],n[2]);return;default:while(++i<s)(r=t[i]).callback.apply(r.ctx,n)}},i=Backbone.Events={on:function(e,t,n){this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){var r=this,i=_.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n),this},off:function(e,t,n){var r,i,s,o,u,a,f,l;if(!this._events)return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:_.keys(this._events);for(u=0,a=o.length;u<a;u++){e=o[u];if(r=this._events[e]){s=[];if(t||n)for(f=0,l=r.length;f<l;f++)i=r[f],(t&&t!==(i.callback._callback||i.callback)||n&&n!==i.context)&&s.push(i);this._events[e]=s}}return this},trigger:function(e){if(!this._events)return this;var n=t.call(arguments,1),i=this._events[e],s=this._events.all;return i&&r(this,i,n),s&&r(this,s,arguments),this},listenTo:function(e,t,n){var r=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=_.uniqueId("l"));return r[i]=e,e.on(t,n||this,this),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return;if(e)e.off(t,n,this),!t&&!n&&delete r[e._listenerId];else{for(var i in r)r[i].off(null,null,this);this._listeners={}}return this}};i.bind=i.on,i.unbind=i.off,typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(exports=module.exports=i),exports.Backbone=exports.Backbone||Backbone)})(),function(){function i(n,r){var i=(new Date).getTime(),s=Math.max(0,16-(i-t)),o=e.setTimeout(function(){n(i+s)},s);return t=i+s,o}var e=this,t=0,n=["ms","moz","webkit","o"];if(typeof exports!="undefined"){typeof module!="undefined"&&module.exports&&(exports=module.exports=i),exports.requestAnimationFrame=i;return}for(var r=0;r<n.length&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[n[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=i),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(){function O(){var e=document.body.getBoundingClientRect(),t=this.width=e.width,n=this.height=e.height;this.renderer.setSize(t,n,this.ratio),this.trigger(m.Events.resize,t,n)}function M(){return(e.performance&&e.performance.now?e.performance:Date).now()}var e=this,t=e.Two||{},n=Math.sin,r=Math.cos,i=Math.atan2,s=Math.sqrt,o=Math.round,u=Math.abs,a=Math.PI,f=a*2,l=a/2,c=Math.pow,h=Math.min,p=Math.max,d=0,v={hasEventListeners:_.isFunction(e.addEventListener),bind:function(e,t,n,r){return this.hasEventListeners?e.addEventListener(t,n,!!r):e.attachEvent("on"+t,n),this},unbind:function(e,t,n,r){return this.hasEventListeners?e.removeEventListeners(t,n,!!r):e.detachEvent("on"+t,n),this}},m=e.Two=function(t){var n=_.defaults(t||{},{fullscreen:!1,width:640,height:480,type:m.Types.svg,autostart:!1});_.each(n,function(e,t){if(t==="fullscreen"||t==="width"||t==="height"||t==="autostart")return;this[t]=e},this),_.isElement(n.domElement)&&(this.type=m.Types[n.domElement.tagName.toLowerCase()]),this.renderer=new m[this.type](this),m.Utils.setPlaying.call(this,n.autostart),this.frameCount=0;if(n.fullscreen){var r=_.bind(O,this);_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),_.extend(this.renderer.domElement.style,{display:"block",top:0,left:0,right:0,bottom:0,position:"fixed"}),v.bind(e,"resize",r),r()}else _.isElement(n.domElement)||(this.renderer.setSize(n.width,n.height,this.ratio),this.width=n.width,this.height=n.height);this.scene=this.renderer.scene,m.Instances.push(this)};_.extend(m,{Array:e.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Version:"v0.4.0",Identifier:"two_",Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change",remove:"remove",insert:"insert"},Commands:{move:"M",line:"L",curve:"C",close:"Z"},Resolution:8,Instances:[],noConflict:function(){return e.Two=t,this},uniqueId:function(){var e=d;return d++,e},Utils:{release:function(e){if(!_.isObject(e))return;_.isFunction(e.unbind)&&e.unbind(),e.vertices&&(_.isFunction(e.vertices.unbind)&&e.vertices.unbind(),_.each(e.vertices,function(e){_.isFunction(e.unbind)&&e.unbind()})),e.children&&_.each(e.children,function(e){m.Utils.release(e)})},Curve:{CollinearityEpsilon:c(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:.25,angle:0,epsilon:.01},abscissas:[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],weights:[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]]},devicePixelRatio:e.devicePixelRatio||1,getBackingStoreRatio:function(e){return e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1},getRatio:function(e){return m.Utils.devicePixelRatio/N(e)},setPlaying:function(e){return this.playing=!!e,this},getComputedMatrix:function(e,t){t=t&&t.identity()||new m.Matrix;var n=e,r=[];while(n&&n._matrix)r.push(n._matrix),n=n.parent;return r.reverse(),_.each(r,function(e){var n=e.elements;t.multiply(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9])}),t},deltaTransformPoint:function(e,t,n){var r=t*e.a+n*e.c+0,i=t*e.b+n*e.d+0;return new m.Vector(r,i)},decomposeMatrix:function(e){var t=m.Utils.deltaTransformPoint(e,0,1),n=m.Utils.deltaTransformPoint(e,1,0),r=180/Math.PI*Math.atan2(t.y,t.x)-90,i=180/Math.PI*Math.atan2(n.y,n.x);return{translateX:e.e,translateY:e.f,scaleX:Math.sqrt(e.a*e.a+e.b*e.b),scaleY:Math.sqrt(e.c*e.c+e.d*e.d),skewX:r,skewY:i,rotation:r}},applySvgAttributes:function(e,t){var n={},r={},i,s,o,u;if(getComputedStyle){var a=getComputedStyle(e);i=a.length;while(i--)s=a[i],o=a[s],o!==undefined&&(r[s]=o)}i=e.attributes.length;while(i--)u=e.attributes[i],n[u.nodeName]=u.value;_.isUndefined(r.opacity)||(r["stroke-opacity"]=r.opacity,r["fill-opacity"]=r.opacity),_.extend(r,n),r.visible=!_.isUndefined(r.display)||r.display!=="none"||_.isUndefined(r.visibility)&&r.visibility==="hidden";for(s in r){o=r[s];switch(s){case"transform":if(o==="none")break;var f=e.getCTM();if(f===null)break;var l=m.Utils.decomposeMatrix(e.getCTM());t.translation.set(l.translateX,l.translateY),t.rotation=l.rotation,t.scale=l.scaleX,r.x&&(t.translation.x=r.x),r.y&&(t.translation.y=r.y);break;case"visible":t.visible=o;break;case"stroke-linecap":t.cap=o;break;case"stroke-linejoin":t.join=o;break;case"stroke-miterlimit":t.miter=o;break;case"stroke-width":t.linewidth=parseFloat(o);break;case"stroke-opacity":case"fill-opacity":case"opacity":t.opacity=parseFloat(o);break;case"fill":case"stroke":t[s]=o==="none"?"transparent":o;break;case"id":t.id=o;break;case"class":t.classList=o.split(" ")}}return t},read:{svg:function(){return m.Utils.read.g.apply(this,arguments)},g:function(e){var t=new m.Group;m.Utils.applySvgAttributes(e,t);for(var n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n],s=i.nodeName;if(!s)return;var o=s.replace(/svg\:/ig,"").toLowerCase();if(o in m.Utils.read){var u=m.Utils.read[o].call(this,i);t.add(u)}}return t},polygon:function(e,t){var n=e.getAttribute("points"),r=[];n.replace(/(-?[\d\.?]+),(-?[\d\.?]+)/g,function(e,t,n){r.push(new m.Anchor(parseFloat(t),parseFloat(n)))});var i=(new m.Polygon(r,!t)).noStroke();return i.fill="black",m.Utils.applySvgAttributes(e,i)},polyline:function(e){return m.Utils.read.polygon(e,!0)},path:function(e){var t=e.getAttribute("d"),n=new m.Anchor,r,i,s=!1,o=!1,u=t.match(/[a-df-z][^a-df-z]*/ig),a=u.length-1;_.each(u.slice(0),function(e,t){var n=e[0],r=n.toLowerCase(),i=e.slice(1).trim().split(/[\s,]+|(?=\s?[+\-])/),s,o,a=[],f;t<=0&&(u=[]);switch(r){case"h":case"v":i.length>1&&(f=1);break;case"m":case"l":case"t":i.length>2&&(f=2);break;case"s":case"q":i.length>4&&(f=4);break;case"c":i.length>6&&(f=6);break;case"a":}if(f){for(var l=0,c=i.length,h=0;l<c;l+=f){var p=n;if(h>0)switch(n){case"m":p="l";break;case"M":p="L"}a.push([p].concat(i.slice(l,l+f)).join(" ")),h++}u=Array.prototype.concat.apply(u,a)}else u.push(e)});var f=_.flatten(_.map(u,function(e,t){var u,f,l,h=e[0],p=h.toLowerCase();i=e.slice(1).trim(),i=i.replace(/(-?\d+(?:\.\d*)?)[eE]([+\-]?\d+)/g,function(e,t,n){return parseFloat(t)*c(10,n)}),i=i.split(/[\s,]+|(?=\s?[+\-])/),o=h===p;var d,v,g,y,b,w,E,S,x;switch(p){case"z":t>=a?s=!0:(f=n.x,l=n.y,u=new m.Anchor(f,l,undefined,undefined,undefined,undefined,m.Commands.close));break;case"m":case"l":f=parseFloat(i[0]),l=parseFloat(i[1]),u=new m.Anchor(f,l,undefined,undefined,undefined,undefined,p==="m"?m.Commands.move:m.Commands.line),o&&u.addSelf(n),n=u;break;case"h":case"v":var T=p==="h"?"x":"y",N=T==="x"?"y":"x";u=new m.Anchor(undefined,undefined,undefined,undefined,undefined,undefined,m.Commands.line),u[T]=parseFloat(i[0]),u[N]=n[N],o&&(u[T]+=n[T]),n=u;break;case"c":case"s":d=n.x,v=n.y,r||(r=new m.Vector),p==="c"?(g=parseFloat(i[0]),y=parseFloat(i[1]),b=parseFloat(i[2]),w=parseFloat(i[3]),E=parseFloat(i[4]),S=parseFloat(i[5])):(x=A(n,r,o),g=x.x,y=x.y,b=parseFloat(i[0]),w=parseFloat(i[1]),E=parseFloat(i[2]),S=parseFloat(i[3])),o&&(g+=d,y+=v,b+=d,w+=v,E+=d,S+=v),_.isObject(n.controls)||m.Anchor.AppendCurveProperties(n),n.controls.right.set(g-n.x,y-n.y),u=new m.Anchor(E,S,b-E,w-S,undefined,undefined,m.Commands.curve),n=u,r=u.controls.left;break;case"t":case"q":d=n.x,v=n.y,r||(r=new m.Vector),r.isZero()?(g=d,y=v):(g=r.x,v=r.y),p==="q"?(b=parseFloat(i[0]),w=parseFloat(i[1]),E=parseFloat(i[1]),S=parseFloat(i[2])):(x=A(n,r,o),b=x.x,w=x.y,E=parseFloat(i[0]),S=parseFloat(i[1])),o&&(g+=d,y+=v,b+=d,w+=v,E+=d,S+=v),_.isObject(n.controls)||m.Anchor.AppendCurveProperties(n),n.controls.right.set(g-n.x,y-n.y),u=new m.Anchor(E,S,b-E,w-S,undefined,undefined,m.Commands.curve),n=u,r=u.controls.left;break;case"a":throw new m.Utils.Error("not yet able to interpret Elliptical Arcs.")}return u}));if(f.length<=1)return;f=_.compact(f);var l=(new m.Polygon(f,s,undefined,!0)).noStroke();return l.fill="black",m.Utils.applySvgAttributes(e,l)},circle:function(e){var t=parseFloat(e.getAttribute("cx")),i=parseFloat(e.getAttribute("cy")),s=parseFloat(e.getAttribute("r")),o=m.Resolution,u=_.map(_.range(o),function(e){var t=e/o,i=t*f,u=s*r(i),a=s*n(i);return new m.Anchor(u,a)},this),a=(new m.Polygon(u,!0,!0)).noStroke();return a.translation.set(t,i),a.fill="black",m.Utils.applySvgAttributes(e,a)},ellipse:function(e){var t=parseFloat(e.getAttribute("cx")),i=parseFloat(e.getAttribute("cy")),s=parseFloat(e.getAttribute("rx")),o=parseFloat(e.getAttribute("ry")),u=m.Resolution,a=_.map(_.range(u),function(e){var t=e/u,i=t*f,a=s*r(i),l=o*n(i);return new m.Anchor(a,l)},this),l=(new m.Polygon(a,!0,!0)).noStroke();return l.translation.set(t,i),l.fill="black",m.Utils.applySvgAttributes(e,l)},rect:function(e){var t=parseFloat(e.getAttribute("x")),n=parseFloat(e.getAttribute("y")),r=parseFloat(e.getAttribute("width")),i=parseFloat(e.getAttribute("height")),s=r/2,o=i/2,u=[new m.Anchor(s,o),new m.Anchor(-s,o),new m.Anchor(-s,-o),new m.Anchor(s,-o)],a=(new m.Polygon(u,!0)).noStroke();return a.translation.set(t+s,n+o),a.fill="black",m.Utils.applySvgAttributes(e,a)},line:function(e){var t=parseFloat(e.getAttribute("x1")),n=parseFloat(e.getAttribute("y1")),r=parseFloat(e.getAttribute("x2")),i=parseFloat(e.getAttribute("y2")),s=r-t,o=i-n,u=s/2,a=o/2,f=[new m.Anchor(-u,-a),new m.Anchor(u,a)],l=(new m.Polygon(f)).noFill();return l.translation.set(t+u,n+a),m.Utils.applySvgAttributes(e,l)}},subdivide:function(e,t,n,r,i,s,o,u,a){a=a||m.Utils.Curve.RecursionLimit;var f=a+1;return e===o&&t===u?[new m.Anchor(o,u)]:_.map(_.range(0,f),function(a){var l=a/f,c=C(l,e,n,i,o),h=C(l,t,r,s,u);return new m.Anchor(c,h)})},getPointOnCubicBezier:function(e,t,n,r,i){var s=1-e;return s*s*s*t+3*s*s*e*n+3*s*e*e*r+e*e*e*i},getCurveLength:function(e,t,n,r,i,o,u,a,f){if(e===n&&t===r&&i===u&&o===a){var l=u-e,c=a-t;return s(l*l+c*c)}var h=9*(n-i)+3*(u-e),p=6*(e+i)-12*n,d=3*(n-e),v=9*(r-o)+3*(a-t),g=6*(t+o)-12*r,y=3*(r-t),b=function(e){var t=(h*e+p)*e+d,n=(v*e+g)*e+y;return s(t*t+n*n)};return L(b,0,1,f||m.Utils.Curve.RecursionLimit)},integrate:function(e,t,n,r){var i=m.Utils.Curve.abscissas[r-2],s=m.Utils.Curve.weights[r-2],o=.5*(n-t),u=o+t,a=0,f=r+1>>1,l=r&1?s[a++]*e(u):0;while(a<f){var c=o*i[a];l+=s[a++]*(e(u+c)+e(u-c))}return o*l},getCurveFromPoints:function(e,t){var n=e.length,r=n-1;for(var i=0;i<n;i++){var s=e[i];_.isObject(s.controls)||m.Anchor.AppendCurveProperties(s);var o=t?T(i-1,n):p(i-1,0),u=t?T(i+1,n):h(i+1,r),a=e[o],f=s,l=e[u];w(a,f,l),f._command=i===0?m.Commands.move:m.Commands.curve,f.controls.left.x=_.isNumber(f.controls.left.x)?f.controls.left.x:f.x,f.controls.left.y=_.isNumber(f.controls.left.y)?f.controls.left.y:f.y,f.controls.right.x=_.isNumber(f.controls.right.x)?f.controls.right.x:f.x,f.controls.right.y=_.isNumber(f.controls.right.y)?f.controls.right.y:f.y}},getControlPoints:function(e,t,i){var s=b(e,t),o=b(i,t),u=g(e,t),f=g(i,t),c=(s+o)/2;return t.u=_.isObject(t.controls.left)?t.controls.left:new m.Vector(0,0),t.v=_.isObject(t.controls.right)?t.controls.right:new m.Vector(0,0),u<1e-4||f<1e-4?(t._relative||(t.controls.left.copy(t),t.controls.right.copy(t)),t):(u*=.33,f*=.33,o<s?c+=l:c-=l,t.controls.left.x=r(c)*u,t.controls.left.y=n(c)*u,c-=a,t.controls.right.x=r(c)*f,t.controls.right.y=n(c)*f,t._relative||(t.controls.left.x+=t.x,t.controls.left.y+=t.y,t.controls.right.x+=t.x,t.controls.right.y+=t.y),t)},getReflection:function(e,t,n){return new m.Vector(2*e.x-(t.x+e.x)-(n?e.x:0),2*e.y-(t.y+e.y)-(n?e.y:0))},angleBetween:function(e,t){var n,r;return arguments.length>=4?(n=arguments[0]-arguments[2],r=arguments[1]-arguments[3],i(r,n)):(n=e.x-t.x,r=e.y-t.y,i(r,n))},distanceBetweenSquared:function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},distanceBetween:function(e,t){return s(y(e,t))},toFixed:function(e){return Math.floor(e*1e3)/1e3},mod:function(e,t){while(e<0)e+=t;return e%t},Collection:function(){Array.call(this),arguments.length>1?Array.prototype.push.apply(this,arguments):arguments[0]&&Array.isArray(arguments[0])&&Array.prototype.push.apply(this,arguments[0])},Error:function(e){this.name="two.js",this.message=e}}}),m.Utils.Error.prototype=new Error,m.Utils.Error.prototype.constructor=m.Utils.Error,m.Utils.Collection.prototype=new Array,m.Utils.Collection.constructor=m.Utils.Collection,_.extend(m.Utils.Collection.prototype,Backbone.Events,{pop:function(){var e=Array.prototype.pop.apply(this,arguments);return this.trigger(m.Events.remove,[e]),e},shift:function(
){var e=Array.prototype.shift.apply(this,arguments);return this.trigger(m.Events.remove,[e]),e},push:function(){var e=Array.prototype.push.apply(this,arguments);return this.trigger(m.Events.insert,arguments),e},unshift:function(){var e=Array.prototype.unshift.apply(this,arguments);return this.trigger(m.Events.insert,arguments),e},splice:function(){var e=Array.prototype.splice.apply(this,arguments),t;return this.trigger(m.Events.remove,e),arguments.length>2&&(t=this.slice(arguments[0],arguments.length-2),this.trigger(m.Events.insert,t)),e}});var g=m.Utils.distanceBetween,y=m.Utils.distanceBetweenSquared,b=m.Utils.angleBetween,w=m.Utils.getControlPoints,E=m.Utils.getCurveFromPoints,S=m.Utils.solveSegmentIntersection,x=m.Utils.decoupleShapes,T=m.Utils.mod,N=m.Utils.getBackingStoreRatio,C=m.Utils.getPointOnCubicBezier,k=m.Utils.getCurveLength,L=m.Utils.integrate,A=m.Utils.getReflection;_.extend(m.prototype,Backbone.Events,{appendTo:function(e){return e.appendChild(this.renderer.domElement),this},play:function(){return m.Utils.setPlaying.call(this,!0),this.trigger(m.Events.play)},pause:function(){return this.playing=!1,this.trigger(m.Events.pause)},update:function(){var e=!!this._lastFrame,t=M();this.frameCount++,e&&(this.timeDelta=parseFloat((t-this._lastFrame).toFixed(3))),this._lastFrame=t;var n=this.width,r=this.height,i=this.renderer;return(n!==i.width||r!==i.height)&&i.setSize(n,r,this.ratio),this.trigger(m.Events.update,this.frameCount,this.timeDelta),this.render()},render:function(){return this.renderer.render(),this.trigger(m.Events.render,this.frameCount)},add:function(e){var t=e;return _.isArray(e)||(t=_.toArray(arguments)),this.scene.add(t),this},remove:function(e){var t=e;return _.isArray(e)||(t=_.toArray(arguments)),this.scene.remove(t),this},clear:function(){return this.scene.remove(_.toArray(this.scene.children)),this},makeLine:function(e,t,n,r){var i=n-e,s=r-t,o=i/2,u=s/2,a=[new m.Anchor(-o,-u),new m.Anchor(o,u)],f=(new m.Polygon(a)).noFill();return f.translation.set(e+o,t+u),this.scene.add(f),f},makeRectangle:function(e,t,n,r){var i=n/2,s=r/2,o=[new m.Anchor(-i,-s),new m.Anchor(i,-s),new m.Anchor(i,s),new m.Anchor(-i,s)],u=new m.Polygon(o,!0);return u.translation.set(e,t),this.scene.add(u),u},makeCircle:function(e,t,n){return this.makeEllipse(e,t,n,n)},makeEllipse:function(e,t,i,s){var o=m.Resolution,u=_.map(_.range(o),function(e){var t=e/o,u=t*f,a=i*r(u),l=s*n(u);return new m.Anchor(a,l)},this),a=new m.Polygon(u,!0,!0);return a.translation.set(e,t),this.scene.add(a),a},makeCurve:function(e){var t=arguments.length,n=e;if(!_.isArray(e)){n=[];for(var r=0;r<t;r+=2){var i=arguments[r];if(!_.isNumber(i))break;var s=arguments[r+1];n.push(new m.Anchor(i,s))}}var o=arguments[t-1],u=new m.Polygon(n,_.isBoolean(o)?!o:!undefined,!0),a=u.getBoundingClientRect(),f=a.left+a.width/2,l=a.top+a.height/2;return _.each(u.vertices,function(e){e.x-=f,e.y-=l}),u.translation.set(f,l),this.scene.add(u),u},makePolygon:function(e){var t=arguments.length,n=e;if(!_.isArray(e)){n=[];for(var r=0;r<t;r+=2){var i=arguments[r];if(!_.isNumber(i))break;var s=arguments[r+1];n.push(new m.Anchor(i,s))}}var o=arguments[t-1],u=new m.Polygon(n,_.isBoolean(o)?!o:!undefined),a=u.getBoundingClientRect();return u.center().translation.set(a.left+a.width/2,a.top+a.height/2),this.scene.add(u),u},makeGroup:function(e){var t=e;_.isArray(e)||(t=_.toArray(arguments));var n=new m.Group;return this.scene.add(n),n.add(t),n},interpret:function(e,t){var n=e.tagName.toLowerCase();if(n in m.Utils.read){var r=m.Utils.read[n].call(this,e);return t&&r instanceof m.Group?this.add(_.values(r.children)):this.add(r),r}return null}}),function(){requestAnimationFrame(arguments.callee),m.Instances.forEach(function(e){e.playing&&e.update()})}(),typeof define=="function"&&define.amd?define(function(){return m}):typeof module!="undefined"&&module.exports&&(module.exports=m)}(),function(e){var t=e.Vector=function(e,t){this.x=e||0,this.y=t||0};_.extend(t,{zero:new e.Vector}),_.extend(t.prototype,Backbone.Events,{set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new t(this.x,this.y)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this},multiplySelf:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return this.distanceTo(e)<1e-4},lerp:function(e,t){var n=(e.x-this.x)*t+this.x,r=(e.y-this.y)*t+this.y;return this.set(n,r)},isZero:function(){return this.length()<1e-4},toString:function(){return this.x+","+this.y},toObject:function(){return{x:this.x,y:this.y}}});var n={set:function(t,n){return this._x=t,this._y=n,this.trigger(e.Events.change)},copy:function(t){return this._x=t.x,this._y=t.y,this.trigger(e.Events.change)},clear:function(){return this._x=0,this._y=0,this.trigger(e.Events.change)},clone:function(){return new t(this._x,this._y)},add:function(t,n){return this._x=t.x+n.x,this._y=t.y+n.y,this.trigger(e.Events.change)},addSelf:function(t){return this._x+=t.x,this._y+=t.y,this.trigger(e.Events.change)},sub:function(t,n){return this._x=t.x-n.x,this._y=t.y-n.y,this.trigger(e.Events.change)},subSelf:function(t){return this._x-=t.x,this._y-=t.y,this.trigger(e.Events.change)},multiplySelf:function(t){return this._x*=t.x,this._y*=t.y,this.trigger(e.Events.change)},multiplyScalar:function(t){return this._x*=t,this._y*=t,this.trigger(e.Events.change)},divideScalar:function(t){return t?(this._x/=t,this._y/=t,this.trigger(e.Events.change)):this.clear()},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this._x*e.x+this._y*e.y},lengthSquared:function(){return this._x*this._x+this._y*this._y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this._x-e.x,n=this._y-e.y;return t*t+n*n},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return this.distanceTo(e)<1e-4},lerp:function(e,t){var n=(e.x-this._x)*t+this._x,r=(e.y-this._y)*t+this._y;return this.set(n,r)},isZero:function(){return this.length()<1e-4},toString:function(){return this._x+","+this._y},toObject:function(){return{x:this._x,y:this._y}}},r={get:function(){return this._x},set:function(t){this._x=t,this.trigger(e.Events.change,"x")}},i={get:function(){return this._y},set:function(t){this._y=t,this.trigger(e.Events.change,"y")}};e.Vector.prototype.bind=e.Vector.prototype.on=function(){return this._bound||(this._x=this.x,this._y=this.y,Object.defineProperty(this,"x",r),Object.defineProperty(this,"y",i),_.extend(this,n),this._bound=!0),Backbone.Events.bind.apply(this,arguments),this}}(Two),function(e){var t=e.Commands,n=e.Anchor=function(r,i,s,o,u,a,f){e.Vector.call(this,r,i),this._broadcast=_.bind(function(){this.trigger(e.Events.change)},this),this._command=f||t.move,this._relative=!0;if(!f)return this;n.AppendCurveProperties(this),_.isNumber(s)&&(this.controls.left.x=s),_.isNumber(o)&&(this.controls.left.y=o),_.isNumber(u)&&(this.controls.right.x=u),_.isNumber(a)&&(this.controls.right.y=a)};_.extend(n,{AppendCurveProperties:function(t){t.controls={left:new e.Vector(0,0),right:new e.Vector(0,0)}}});var r={listen:function(){return _.isObject(this.controls)||n.AppendCurveProperties(this),this.controls.left.bind(e.Events.change,this._broadcast),this.controls.right.bind(e.Events.change,this._broadcast),this},ignore:function(){return this.controls.left.unbind(e.Events.change,this._broadcast),this.controls.right.unbind(e.Events.change,this._broadcast),this},clone:function(){var t=this.controls,n=new e.Anchor(this.x,this.y,t&&t.left.x,t&&t.left.y,t&&t.right.x,t&&t.right.y,this.command);return n.relative=this._relative,n},toObject:function(){var e={x:this.x,y:this.y};return this._command&&(e.command=this._command),this._relative&&(e.relative=this._relative),this.controls&&(e.controls={left:this.controls.left.toObject(),right:this.controls.right.toObject()}),e}};Object.defineProperty(n.prototype,"command",{get:function(){return this._command},set:function(r){return this._command=r,this._command===t.curve&&!_.isObject(this.controls)&&n.AppendCurveProperties(this),this.trigger(e.Events.change)}}),Object.defineProperty(n.prototype,"relative",{get:function(){return this._relative},set:function(t){return this._relative==t?this:(this._relative=!!t,this.trigger(e.Events.change))}}),_.extend(n.prototype,e.Vector.prototype,r),e.Anchor.prototype.bind=e.Anchor.prototype.on=function(){e.Vector.prototype.bind.apply(this,arguments),_.extend(this,r)},e.Anchor.prototype.unbind=e.Anchor.prototype.off=function(){e.Vector.prototype.unbind.apply(this,arguments),_.extend(this,r)}}(Two),function(e){var t=Math.cos,n=Math.sin,r=Math.tan,i=e.Matrix=function(t,n,r,i,s,o){this.elements=new e.Array(9);var u=t;_.isArray(u)||(u=_.toArray(arguments)),this.identity().set(u)};_.extend(i,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(t,n,r){if(n.length<=3){var i,s,o,u=t,a=n[0]||0,f=n[1]||0,l=n[2]||0;return i=u[0]*a+u[1]*f+u[2]*l,s=u[3]*a+u[4]*f+u[5]*l,o=u[6]*a+u[7]*f+u[8]*l,{x:i,y:s,z:o}}var c=t[0],h=t[1],p=t[2],d=t[3],v=t[4],m=t[5],g=t[6],y=t[7],b=t[8],w=n[0],E=n[1],S=n[2],x=n[3],T=n[4],N=n[5],C=n[6],k=n[7],L=n[8];return r=r||new e.Array(9),r[0]=c*w+h*x+p*C,r[1]=c*E+h*T+p*k,r[2]=c*S+h*N+p*L,r[3]=d*w+v*x+m*C,r[4]=d*E+v*T+m*k,r[5]=d*S+v*N+m*L,r[6]=g*w+y*x+b*C,r[7]=g*E+y*T+b*k,r[8]=g*S+y*N+b*L,r}}),_.extend(i.prototype,Backbone.Events,{set:function(t){var n=t;return _.isArray(n)||(n=_.toArray(arguments)),_.extend(this.elements,n),this.trigger(e.Events.change)},identity:function(){return this.set(i.Identity),this},multiply:function(t,n,r,i,s,o,u,a,f){var l=arguments,c=l.length;if(c<=1)return _.each(this.elements,function(e,n){this.elements[n]=e*t},this),this.trigger(e.Events.change);if(c<=3){var h,p,d;return t=t||0,n=n||0,r=r||0,s=this.elements,h=s[0]*t+s[1]*n+s[2]*r,p=s[3]*t+s[4]*n+s[5]*r,d=s[6]*t+s[7]*n+s[8]*r,{x:h,y:p,z:d}}var v=this.elements,m=l,g=v[0],y=v[1],b=v[2],w=v[3],E=v[4],S=v[5],x=v[6],T=v[7],N=v[8],C=m[0],k=m[1],L=m[2],A=m[3],O=m[4],M=m[5],D=m[6],P=m[7],H=m[8];return this.elements[0]=g*C+y*A+b*D,this.elements[1]=g*k+y*O+b*P,this.elements[2]=g*L+y*M+b*H,this.elements[3]=w*C+E*A+S*D,this.elements[4]=w*k+E*O+S*P,this.elements[5]=w*L+E*M+S*H,this.elements[6]=x*C+T*A+N*D,this.elements[7]=x*k+T*O+N*P,this.elements[8]=x*L+T*M+N*H,this.trigger(e.Events.change)},inverse:function(t){var n=this.elements;t=t||new e.Matrix;var r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l=n[7],c=n[8],h=c*u-a*l,p=-c*o+a*f,d=l*o-u*f,v=r*h+i*p+s*d;return v?(v=1/v,t.elements[0]=h*v,t.elements[1]=(-c*i+s*l)*v,t.elements[2]=(a*i-s*u)*v,t.elements[3]=p*v,t.elements[4]=(c*r-s*f)*v,t.elements[5]=(-a*r+s*o)*v,t.elements[6]=d*v,t.elements[7]=(-l*r+i*f)*v,t.elements[8]=(u*r-i*o)*v,t):null},scale:function(e,t){var n=arguments.length;return n<=1&&(t=e),this.multiply(e,0,0,0,t,0,0,0,1)},rotate:function(e){var r=t(e),i=n(e);return this.multiply(r,-i,0,i,r,0,0,0,1)},translate:function(e,t){return this.multiply(1,0,e,0,1,t,0,0,1)},skewX:function(e){var t=r(e);return this.multiply(1,t,0,0,1,0,0,0,1)},skewY:function(e){var t=r(e);return this.multiply(1,0,0,t,1,0,0,0,1)},toString:function(e){var t=[];return this.toArray(e,t),t.join(" ")},toArray:function(e,t){var n=this.elements,r=!!t,i=parseFloat(n[0].toFixed(3)),s=parseFloat(n[1].toFixed(3)),o=parseFloat(n[2].toFixed(3)),u=parseFloat(n[3].toFixed(3)),a=parseFloat(n[4].toFixed(3)),f=parseFloat(n[5].toFixed(3));if(!!e){var l=parseFloat(n[6].toFixed(3)),c=parseFloat(n[7].toFixed(3)),h=parseFloat(n[8].toFixed(3));if(r){t[0]=i,t[1]=u,t[2]=l,t[3]=s,t[4]=a,t[5]=c,t[6]=o,t[7]=f,t[8]=h;return}return[i,u,l,s,a,c,o,f,h]}if(r){t[0]=i,t[1]=u,t[2]=s,t[3]=a,t[4]=o,t[5]=f;return}return[i,u,s,a,o,f]},clone:function(){var t,n,r,i,s,o,u,a,f;return t=this.elements[0],n=this.elements[1],r=this.elements[2],i=this.elements[3],s=this.elements[4],o=this.elements[5],u=this.elements[6],a=this.elements[7],f=this.elements[8],new e.Matrix(t,n,r,i,s,o,u,a,f)}})}(Two),function(e){var t=e.Utils.mod,n=e.Utils.toFixed,r={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(e,t){var n=e,i=document.createElementNS(this.ns,n);return n==="svg"&&(t=_.defaults(t||{},{version:this.version})),_.isObject(t)&&r.setAttributes(i,t),i},setAttributes:function(e,t){for(var n in t)e.setAttribute(n,t[n]);return this},removeAttributes:function(e,t){for(var n in t)e.removeAttribute(n);return this},toString:function(r,i){var s=r.length,o=s-1,u,a="";for(var f=0;f<s;f++){var l=r[f],c,h=i?t(f-1,s):Math.max(f-1,0),p=i?t(f+1,s):Math.min(f+1,o),d=r[h],v=r[p],m,g,y,b,w,E,S,x,T=n(l._x),N=n(l._y);switch(l._command){case e.Commands.close:c=e.Commands.close;break;case e.Commands.curve:w=d.controls&&d.controls.right||d,E=l.controls&&l.controls.left||l,d._relative?(m=n(w.x+d.x),g=n(w.y+d.y)):(m=n(w.x),g=n(w.y)),l._relative?(y=n(E.x+l.x),b=n(E.y+l.y)):(y=n(E.x),b=n(E.y)),c=(f===0?e.Commands.move:e.Commands.curve)+" "+m+" "+g+" "+y+" "+b+" "+T+" "+N;break;case e.Commands.move:u=l,c=e.Commands.move+" "+T+" "+N;break;default:c=l._command+" "+T+" "+N}f>=o&&i&&(l._command===e.Commands.curve&&(v=u,S=l.controls&&l.controls.right||l,x=v.controls&&v.controls.left||v,l._relative?(m=n(S.x+l.x),g=n(S.y+l.y)):(m=n(S.x),g=n(S.y)),v._relative?(y=n(x.x+v.x),b=n(x.y+v.y)):(y=n(x.x),b=n(x.y)),T=n(v.x),N=n(v.y),c+=" C "+m+" "+g+" "+y+" "+b+" "+T+" "+N),c+=" Z"),a+=c+" "}return a},getClip:function(e){clip=e._renderer.clip;if(!clip){root=e;while(root.parent)root=root.parent;clip=e._renderer.clip=r.createElement("clipPath"),root.defs.appendChild(clip)}return clip},group:{appendChild:function(e){var t=this.domElement.querySelector("#"+e);if(!t)return;var n=t.nodeName;if(!n)return;var r=n.replace(/svg\:/ig,"").toLowerCase();if(/clippath/.test(r))return;this.elem.appendChild(t)},removeChild:function(e){var t=this.domElement.querySelector("#"+e);if(!t)return;var n=t.nodeName;if(!n)return;var r=n.replace(/svg\:/ig,"").toLowerCase();if(/clippath/.test(r))return;this.elem.removeChild(t)},renderChild:function(e){r[e._renderer.type].render.call(e,this)},render:function(e){this._update();if(this._opacity===0&&!this._flagOpacity)return this;this._renderer.elem||(this._renderer.elem=r.createElement("g",{id:this.id}),e.appendChild(this._renderer.elem));var t=this._matrix.manual||this._flagMatrix,n={domElement:e,elem:this._renderer.elem};t&&this._renderer.elem.setAttribute("transform","matrix("+this._matrix.toString()+")");for(var i in this.children){var s=this.children[i];r[s._renderer.type].render.call(s,e)}return this._flagOpacity&&this._renderer.elem.setAttribute("opacity",this._opacity),this._flagAdditions&&_.each(this.additions,r.group.appendChild,n),this._flagSubtractions&&_.each(this.subtractions,r.group.removeChild,n),this._flagMask&&(this._mask?this._renderer.elem.setAttribute("clip-path","url(#"+this._mask.id+")"):this._renderer.elem.removeAttribute("clip-path")),this.flagReset()}},polygon:{render:function(e){this._update();if(this._opacity===0&&!this._flagOpacity)return this;var t={},n=this._matrix.manual||this._flagMatrix;n&&(t.transform="matrix("+this._matrix.toString()+")");if(this._flagVertices){var i=r.toString(this._vertices,this._closed);t.d=i}return this._flagFill&&(t.fill=this._fill),this._flagStroke&&(t.stroke=this._stroke),this._flagLinewidth&&(t["stroke-width"]=this._linewidth),this._flagOpacity&&(t["stroke-opacity"]=this._opacity,t["fill-opacity"]=this._opacity),this._flagVisible&&(t.visibility=this._visible?"visible":"hidden"),this._flagCap&&(t["stroke-linecap"]=this._cap),this._flagJoin&&(t["stroke-linejoin"]=this._join),this._flagMiter&&(t["stroke-miterlimit"]=this.miter),this._renderer.elem?r.setAttributes(this._renderer.elem,t):(t.id=this.id,this._renderer.elem=r.createElement("path",t),e.appendChild(this._renderer.elem)),this._flagClip&&(clip=r.getClip(this),elem=this._renderer.elem,this._clip?(elem.removeAttribute("id"),clip.setAttribute("id",this.id),clip.appendChild(elem)):(clip.removeAttribute("id"),elem.setAttribute("id",this.id),this.parent._renderer.elem.appendChild(elem))),this.flagReset()}}},i=e[e.Types.svg]=function(t){this.domElement=t.domElement||r.createElement("svg"),this.scene=new e.Group,this.scene.parent=this,this.defs=r.createElement("defs"),this.domElement.appendChild(this.defs)};_.extend(i,{Utils:r}),_.extend(i.prototype,Backbone.Events,{setSize:function(e,t){return this.width=e,this.height=t,r.setAttributes(this.domElement,{width:e,height:t}),this},render:function(){return r.group.render.call(this.scene,this.domElement),this}})}(Two),function(e){function o(e){e.setTransform(1,0,0,1,0,0)}var t=e.Utils.mod,n=e.Utils.toFixed,r=e.Utils.getRatio,i={group:{renderChild:function(e){i[e._renderer.type].render.call(e,this.ctx,!0,this.clip)},render:function(e){this._update();var t=this._matrix.elements,n=this.parent;this._renderer.opacity=this._opacity*(n&&n._renderer?n._renderer.opacity:1);var r=this._mask;return this._renderer.context||(this._renderer.context={}),this._renderer.context.ctx=e,e.save(),e.transform(t[0],t[3],t[1],t[4],t[2],t[5]),r&&i[r._renderer.type].render.call(r,e,!0),_.each(this.children,i.group.renderChild,this._renderer.context),e.restore(),this.flagReset()}},polygon:{render:function(r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,D,P,H,B;return this._update(),o=this._matrix.elements,u=this._stroke,a=this._linewidth,f=this._fill,l=this._opacity*this.parent._renderer.opacity,c=this._visible,h=this._cap,p=this._join,d=this._miter,v=this._closed,m=this._vertices,g=m.length,y=g-1,B=this._clip,!i&&(!c||B)?this:(r.save(),o&&r.transform(o[0],o[3],o[1],o[4],o[2],o[5]),f&&(r.fillStyle=f),u&&(r.strokeStyle=u),a&&(r.lineWidth=a),d&&(r.miterLimit=d),p&&(r.lineJoin=p),h&&(r.lineCap=h),_.isNumber(l)&&(r.globalAlpha=l),r.beginPath(),m.forEach(function(i,s){D=n(i.x),P=n(i.y);switch(i._command){case e.Commands.close:r.closePath();break;case e.Commands.curve:w=v?t(s-1,g):Math.max(s-1,0),b=v?t(s+1,g):Math.min(s+1,y),E=m[w],S=m[b],L=E.controls&&E.controls.right||E,A=i.controls&&i.controls.left||i,E._relative?(C=L.x+n(E.x),k=L.y+n(E.y)):(C=n(L.x),k=n(L.y)),i._relative?(T=A.x+n(i.x),N=A.y+n(i.y)):(T=n(A.x),N=n(A.y)),r.bezierCurveTo(C,k,T,N,D,P),s>=y&&v&&(S=x,O=i.controls&&i.controls.right||i,M=S.controls&&S.controls.left||S,i._relative?(C=O.x+n(i.x),k=O.y+n(i.y)):(C=n(O.x),k=n(O.y)),S._relative?(T=M.x+n(S.x),N=M.y+n(S.y)):(T=n(M.x),N=n(M.y)),D=n(S.x),P=n(S.y),r.bezierCurveTo(C,k,T,N,D,P));break;case e.Commands.line:r.lineTo(D,P);break;case e.Commands.move:x=i,r.moveTo(D,P)}}),v&&r.closePath(),!B&&!s&&(r.fill(),r.stroke()),r.restore(),B&&!s&&r.clip(),this.flagReset())}}},s=e[e.Types.canvas]=function(t){this.domElement=t.domElement||document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.overdraw=t.overdraw||!1,this.scene=new e.Group,this.scene.parent=this};_.extend(s,{Utils:i}),_.extend(s.prototype,Backbone.Events,{setSize:function(e,t,n){return this.width=e,this.height=t,this.ratio=_.isUndefined(n)?r(this.ctx):n,this.domElement.width=e*this.ratio,this.domElement.height=t*this.ratio,_.extend(this.domElement.style,{width:e+"px",height:t+"px"}),this},render:function(){var e=this.ratio===1;return e||(this.ctx.save(),this.ctx.scale(this.ratio,this.ratio)),this.overdraw||this.ctx.clearRect(0,0,this.width,this.height),i.group.render.call(this.scene,this.ctx),e||this.ctx.restore(),this}})}(Two),function(e){var t=e.Matrix.Multiply,n=e.Utils.mod,r=[1,0,0,0,1,0,0,0,1],i=new e.Array(9),s=e.Utils.getRatio,o=e.Utils.toFixed,u={canvas:document.createElement("canvas"),uv:new e.Array([0,0,1,0,0,1,0,1,1,0,1,1]),group:{renderChild:function(e){u[e._renderer.type].render.call(e,this.gl,this.program)},render:function(n,r){this._update();var s=this.parent,o=s._matrix&&s._matrix.manual||s._flagMatrix,a=this._matrix.manual||this._flagMatrix;if(o||a)this._renderer.matrix||(this._renderer.matrix=new e.Array(9)),this._matrix.toArray(!0,i),t(i,s._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*s._renderer.scale,o&&(this._flagMatrix=!0);return this._mask&&(n.enable(n.STENCIL_TEST),n.stencilFunc(n.ALWAYS,1,1),n.colorMask(!1,!1,!1,!0),n.stencilOp(n.KEEP,n.KEEP,n.INCR),u[this._mask._renderer.type].render.call(this._mask,n,r,this),n.colorMask(!0,!0,!0,!0),n.stencilFunc(n.NOTEQUAL,0,1),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)),this._flagOpacity=s._flagOpacity||this._flagOpacity,this._renderer.opacity=this._opacity*(s&&s._renderer?s._renderer.opacity:1),_.each(this.children,u.group.renderChild,{gl:n,program:r}),this._mask&&(n.colorMask(!1,!1,!1,!1),n.stencilOp(n.KEEP,n.KEEP,n.DECR),u[this._mask._renderer.type].render.call(this._mask,n,r,this),n.colorMask(!0,!0,!0,!0),n.stencilFunc(n.NOTEQUAL,0,1),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.disable(n.STENCIL_TEST)),this.flagReset()}},polygon:{render:function(n,r,s){if(!this._visible||!this._opacity)return this;var o=this.parent,a=o._matrix.manual||o._flagMatrix,f=this._matrix.manual||this._flagMatrix,l=this._flagVertices||this._flagFill||this._flagStroke||this._flagLinewidth||this._flagOpacity||o._flagOpacity||this._flagVisible||this._flagCap||this._flagJoin||this._flagMiter||this._flagScale;this._update();if(a||f)this._renderer.matrix||(this._renderer.matrix=new e.Array(9)),this._matrix.toArray(!0,i),t(i,o._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*o._renderer.scale;l&&(this._renderer.rect||(this._renderer.rect={}),this._renderer.triangles||(this._renderer.triangles=new e.Array(12)),this._renderer.opacity=this._opacity*o._renderer.opacity,u.getBoundingClientRect(this._vertices,this._linewidth,this._renderer.rect),u.getTriangles(this._renderer.rect,this._renderer.triangles),u.updateBuffer(n,this,r),u.updateTexture(n,this));if(this._clip&&!s)return;return n.bindBuffer(n.ARRAY_BUFFER,this._renderer.textureCoordsBuffer),n.vertexAttribPointer(r.textureCoords,2,n.FLOAT,!1,0,0),n.bindTexture(n.TEXTURE_2D,this._renderer.texture),n.uniformMatrix3fv(r.matrix,!1,this._renderer.matrix),n.bindBuffer(n.ARRAY_BUFFER,this._renderer.buffer),n.vertexAttribPointer(r.position,2,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLES,0,6),this.flagReset()}},getBoundingClientRect:function(e,t,n){var r=Infinity,i=-Infinity,s=Infinity,o=-Infinity,u,a;e.forEach(function(e){var t=e.x,n=e.y,u=e.controls,a,f,l,c,h,p;s=Math.min(n,s),r=Math.min(t,r),i=Math.max(t,i),o=Math.max(n,o);if(!e.controls)return;h=u.left,p=u.right;if(!h||!p)return;a=e._relative?h.x+t:h.x,f=e._relative?h.y+n:h.y,l=e._relative?p.x+t:p.x,c=e._relative?p.y+n:p.y;if(!a||!f||!l||!c)return;s=Math.min(f,c,s),r=Math.min(a,l,r),i=Math.max(a,l,i),o=Math.max(f,c,o)}),_.isNumber(t)&&(s-=t,r-=t,i+=t,o+=t),u=i-r,a=o-s,n.top=s,n.left=r,n.right=i,n.bottom=o,n.width=u,n.height=a,n.centroid||(n.centroid={}),n.centroid.x=-r,n.centroid.y=-s},getTriangles:function(e,t){var n=e.top,r=e.left,i=e.right,s=e.bottom;t[0]=r,t[1]=n,t[2]=i,t[3]=n,t[4]=r,t[5]=s,t[6]=r,t[7]=s,t[8]=i,t[9]=n,t[10]=i,t[11]=s},updateCanvas:function(t){var r=t._vertices,i=this.canvas,s=this.ctx,u=t._renderer.scale,a=t._stroke,f=t._linewidth*u,l=t._fill,c=t._renderer.opacity||t._opacity,h=t._cap,p=t._join,d=t._miter,v=t._closed,m=r.length,g=m-1;i.width=Math.max(Math.ceil(t._renderer.rect.width*u),1),i.height=Math.max(Math.ceil(t._renderer.rect.height*u),1);var y=t._renderer.rect.centroid,b=y.x*u,w=y.y*u;s.clearRect(0,0,i.width,i.height),l&&(s.fillStyle=l),a&&(s.strokeStyle=a),f&&(s.lineWidth=f),d&&(s.miterLimit=d),p&&(s.lineJoin=p),h&&(s.lineCap=h),_.isNumber(c)&&(s.globalAlpha=c);var E;s.beginPath(),r.forEach(function(t,i){var a,f,l,c,h,p,d,y,S,x,T,N,C,k;C=o(t.x*u+b),k=o(t.y*u+w);switch(t._command){case e.Commands.close:s.closePath();break;case e.Commands.curve:f=v?n(i-1,m):Math.max(i-1,0),a=v?n(i+1,m):Math.min(i+1,g),l=r[f],c=r[a],S=l.controls&&l.controls.right||l,x=t.controls&&t.controls.left||t,l._relative?(d=o((S.x+l.x)*u+b),y=o((S.y+l.y)*u+w)):(d=o(S.x*u+b),y=o(S.y*u+w)),t._relative?(h=o((x.x+t.x)*u+b),p=o((x.y+t.y)*u+w)):(h=o(x.x*u+b),p=o(x.y*u+w)),s.bezierCurveTo(d,y,h,p,C,k),i>=g&&v&&(c=E,T=t.controls&&t.controls.right||t,N=c.controls&&c.controls.left||c,t._relative?(d=o((T.x+t.x)*u+b),y=o((T.y+t.y)*u+w)):(d=o(T.x*u+b),y=o(T.y*u+w)),c._relative?(h=o((N.x+c.x)*u+b),p=o((N.y+c.y)*u+w)):(h=o(N.x*u+b),p=o(N.y*u+w)),C=o(c.x*u+b),k=o(c.y*u+w),s.bezierCurveTo(d,y,h,p,C,k));break;case e.Commands.line:s.lineTo(C,k);break;case e.Commands.move:E=t,s.moveTo(C,k)}}),v&&s.closePath(),s.fill(),s.stroke()},updateTexture:function(e,t){this.updateCanvas(t),t._renderer.texture&&e.deleteTexture(t._renderer.texture),e.bindBuffer(e.ARRAY_BUFFER,t._renderer.textureCoordsBuffer),t._renderer.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t._renderer.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);if(this.canvas.width<=0||this.canvas.height<=0)return;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(e,t,n){_.isObject(t._renderer.buffer)&&e.deleteBuffer(t._renderer.buffer),t._renderer.buffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._renderer.buffer),e.enableVertexAttribArray(n.position),e.bufferData(e.ARRAY_BUFFER,t._renderer.triangles,e.STATIC_DRAW),_.isObject(t._renderer.textureCoordsBuffer)&&e.deleteBuffer(t._renderer.textureCoordsBuffer),t._renderer.textureCoordsBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._renderer.textureCoordsBuffer),e.enableVertexAttribArray(n.textureCoords),e.bufferData(e.ARRAY_BUFFER,this.uv,e.STATIC_DRAW)},program:{create:function(t,n){var r,i,s;r=t.createProgram(),_.each(n,function(e){t.attachShader(r,e)}),t.linkProgram(r),i=t.getProgramParameter(r,t.LINK_STATUS);if(!i)throw s=t.getProgramInfoLog(r),t.deleteProgram(r),new e.Utils.Error("unable to link program: "+s);return r}},shaders:{create:function(t,n,r){var i,s,o;i=t.createShader(t[r]),t.shaderSource(i,n),t.compileShader(i),s=t.getShaderParameter(i,t.COMPILE_STATUS);if(!s)throw o=t.getShaderInfoLog(i),t.deleteShader(i),new e.Utils.Error("unable to compile shader "+i+": "+o);return i},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:["attribute vec2 a_position;","attribute vec2 a_textureCoords;","","uniform mat3 u_matrix;","uniform vec2 u_resolution;","","varying vec2 v_textureCoords;","","void main() {","   vec2 projected = (u_matrix * vec3(a_position, 1.0)).xy;","   vec2 normal = projected / u_resolution;","   vec2 clipspace = (normal * 2.0) - 1.0;","","   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);","   v_textureCoords = a_textureCoords;","}"].join("\n"),fragment:["precision mediump float;","","uniform sampler2D u_image;","varying vec2 v_textureCoords;","","void main() {","  gl_FragColor = texture2D(u_image, v_textureCoords);","}"].join("\n")}};u.ctx=u.canvas.getContext("2d");var a=e[e.Types.webgl]=function(t){var n,i,s,o;this.domElement=t.domElement||document.createElement("canvas"),this.scene=new e.Group,this.scene.parent=this,this._renderer={matrix:new e.Array(r),scale:1,opacity:1},this._flagMatrix=!0,n=_.defaults(t||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!0,overdraw:!1}),this.overdraw=n.overdraw,i=this.ctx=this.domElement.getContext("webgl",n)||this.domElement.getContext("experimental-webgl",n);if(!this.ctx)throw new e.Utils.Error("unable to create a webgl context. Try using another renderer.");s=u.shaders.create(i,u.shaders.vertex,u.shaders.types.vertex),o=u.shaders.create(i,u.shaders.fragment,u.shaders.types.fragment),this.program=u.program.create(i,[s,o]),i.useProgram(this.program),this.program.position=i.getAttribLocation(this.program,"a_position"),this.program.matrix=i.getUniformLocation(this.program,"u_matrix"),this.program.textureCoords=i.getAttribLocation(this.program,"a_textureCoords"),i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)};_.extend(a.prototype,Backbone.Events,{setSize:function(e,t,n){this.width=e,this.height=t,this.ratio=_.isUndefined(n)?s(this.ctx):n,this.domElement.width=e*this.ratio,this.domElement.height=t*this.ratio,_.extend(this.domElement.style,{width:e+"px",height:t+"px"}),e*=this.ratio,t*=this.ratio,this._renderer.matrix[0]=this._renderer.matrix[4]=this._renderer.scale=this.ratio,this._flagMatrix=!0,this.ctx.viewport(0,0,e,t);var r=this.ctx.getUniformLocation(this.program,"u_resolution");return this.ctx.uniform2f(r,e,t),this},render:function(){var e=this.ctx;return this.overdraw||e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),u.group.render.call(this.scene,e,this.program),this._flagMatrix=!1,this}})}(Two),function(e){var t=e.Shape=function(){this._renderer={},this.id=e.Identifier+e.uniqueId(),this.classList=[],this._matrix=new e.Matrix,this.translation=new e.Vector,this.translation.bind(e.Events.change,_.bind(t.FlagMatrix,this)),this.rotation=0,this.scale=1};_.extend(t,Backbone.Events,{FlagMatrix:function(){this._flagMatrix=!0},MakeObservable:function(e){Object.defineProperty(e,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._flagMatrix=!0}}),Object.defineProperty(e,"scale",{get:function(){return this._scale},set:function(e){this._scale=e,this._flagMatrix=!0,this._flagScale=!0}})}}),_.extend(t.prototype,{_flagMatrix:!0,_rotation:0,_scale:1,addTo:function(e){return e.add(this),this},clone:function(){var e=new t;return e.translation.copy(this.translation),e.rotation=this.rotation,e.scale=this.scale,_.each(t.Properties,function(t){e[t]=this[t]},this),e._update()},replaceParent:function(e){var t=this.id,n;return this.parent&&(delete this.parent.children[t],n=_.indexOf(parent.additions,t),n>=0&&this.parent.additions.splice(n,1),this.parent.subtractions.push(t),this._flagSubtractions=!0),e?(e.children[t]=this,this.parent=e,e.additions.push(t),e._flagAdditions=!0):delete this.parent,this},_update:function(e){return!this._matrix.manual&&this._flagMatrix&&this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation),e&&this.parent&&this.parent._update&&this.parent._update(),this},flagReset:function(){return this._flagMatrix=this._flagScale=!1,this}}),t.MakeObservable(t.prototype)}(Two),function(e){function u(t,n,r){var i,s,o,u,a,f,l,c,h=n.controls&&n.controls.right,p=t.controls&&t.controls.left;return i=n.x,a=n.y,s=(h||n).x,f=(h||n).y,o=(p||t).x,l=(p||t).y,u=t.x,c=t.y,h&&n._relative&&(s+=n.x,f+=n.y),p&&t._relative&&(o+=t.x,l+=t.y),e.Utils.getCurveLength(i,a,s,f,o,l,u,c,r)}function a(t,n,r){var i,s,o,u,a,f,l,c,h=n.controls&&n.controls.right,p=t.controls&&t.controls.left;return i=n.x,a=n.y,s=(h||n).x,f=(h||n).y,o=(p||t).x,l=(p||t).y,u=t.x,c=t.y,h&&n._relative&&(s+=n.x,f+=n.y),p&&t._relative&&(o+=t.x,l+=t.y),e.Utils.subdivide(i,a,s,f,o,l,u,c,r)}var t=Math.min,n=Math.max,r=Math.round,i=e.Utils.getComputedMatrix,s={};_.each(e.Commands,function(e,t){s[t]=new RegExp(e)});var o=e.Polygon=function(t,n,r,i){e.Shape.call(this),this._renderer.type="polygon",this._closed=!!n,this._curved=!!r,this.beginning=0,this.ending=1,this.fill="#fff",this.stroke="#000",this.linewidth=1,this.opacity=1,this.visible=!0,this.cap="butt",this.join="miter",this.miter=4,this._vertices=[],this.vertices=t,this.automatic=!i};_.extend(o,{Properties:["fill","stroke","linewidth","opacity","visible","cap","join","miter","closed","curved","automatic","beginning","ending"],FlagVertices:function(){this._flagVertices=!0,this._flagLength=!0},MakeObservable:function(r){e.Shape.MakeObservable(r),_.each(o.Properties.slice(0,8),function(e){var t="_"+e,n="_flag"+e.charAt(0).toUpperCase()+e.slice(1);Object.defineProperty(r,e,{get:function(){return this[t]},set:function(e){this[t]=e,this[n]=!0}})}),Object.defineProperty(r,"length",
{get:function(){return this._flagLength&&this._updateLength(),this._length}}),Object.defineProperty(r,"closed",{get:function(){return this._closed},set:function(e){this._closed=!!e,this._flagVertices=!0}}),Object.defineProperty(r,"curved",{get:function(){return this._curved},set:function(e){this._curved=!!e,this._flagVertices=!0}}),Object.defineProperty(r,"automatic",{get:function(){return this._automatic},set:function(e){if(e===this._automatic)return;this._automatic=!!e;var t=this._automatic?"ignore":"listen";_.each(this.vertices,function(e){e[t]()})}}),Object.defineProperty(r,"beginning",{get:function(){return this._beginning},set:function(e){this._beginning=t(n(e,0),this._ending),this._flagVertices=!0}}),Object.defineProperty(r,"ending",{get:function(){return this._ending},set:function(e){this._ending=t(n(e,this._beginning),1),this._flagVertices=!0}}),Object.defineProperty(r,"vertices",{get:function(){return this._collection},set:function(t){var n=_.bind(o.FlagVertices,this),r=_.bind(function(t){var r=t.length;while(r--)t[r].bind(e.Events.change,n);n()},this),i=_.bind(function(t){_.each(t,function(t){t.unbind(e.Events.change,n)},this),n()},this);this._collection&&this._collection.unbind(),this._collection=new e.Utils.Collection(t.slice(0)),this._collection.bind(e.Events.insert,r),this._collection.bind(e.Events.remove,i),r(this._collection)}}),Object.defineProperty(r,"clip",{get:function(){return this._clip},set:function(e){this._clip=e,this._flagClip=!0}})}}),_.extend(o.prototype,e.Shape.prototype,{_flagVertices:!0,_flagLength:!0,_flagFill:!0,_flagStroke:!0,_flagLinewidth:!0,_flagOpacity:!0,_flagVisible:!0,_flagCap:!0,_flagJoin:!0,_flagMiter:!0,_flagClip:!1,_length:0,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,_clip:!1,clone:function(t){t=t||this.parent;var n=_.map(this.vertices,function(e){return e.clone()}),r=new o(n,this.closed,this.curved,!this.automatic);return _.each(e.Shape.Properties,function(e){r[e]=this[e]},this),r.translation.copy(this.translation),r.rotation=this.rotation,r.scale=this.scale,t.add(r),r},toObject:function(){var t={vertices:_.map(this.vertices,function(e){return e.toObject()})};return _.each(e.Shape.Properties,function(e){t[e]=this[e]},this),t.translation=this.translation.toObject,t.rotation=this.rotation,t.scale=this.scale,t},noFill:function(){return this.fill="transparent",this},noStroke:function(){return this.stroke="transparent",this},corner:function(){var e=this.getBoundingClientRect(!0);return e.centroid={x:e.left+e.width/2,y:e.top+e.height/2},_.each(this.vertices,function(t){t.addSelf(e.centroid)}),this},center:function(){var e=this.getBoundingClientRect(!0);return e.centroid={x:e.left+e.width/2,y:e.top+e.height/2},_.each(this.vertices,function(t){t.subSelf(e.centroid)}),this},remove:function(){return this.parent?(this.parent.remove(this),this):this},getBoundingClientRect:function(e){this._update(!0);var r=e?this._matrix:i(this),s=this.linewidth/2,o,u,a=Infinity,f=-Infinity,l=Infinity,c=-Infinity;return _.each(this._vertices,function(e){o=e.x,u=e.y,e=r.multiply(o,u,1),l=t(e.y-s,l),a=t(e.x-s,a),f=n(e.x+s,f),c=n(e.y+s,c)}),{top:l,left:a,right:f,bottom:c,width:f-a,height:c-l}},getPointAt:function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v=this.length*Math.min(Math.max(t,0),1),m=this.vertices.length,g=m-1,y=null,b=null;for(var w=0,E=this._lengths.length,S=0;w<E;w++){if(S+this._lengths[w]>v){y=this.vertices[this.closed?e.Utils.mod(w,m):w],b=this.vertices[Math.min(Math.max(w-1,0),g)],v-=S,t=v/this._lengths[w];break}S+=this._lengths[w]}return _.isNull(y)||_.isNull(b)?null:(d=b.controls&&b.controls.right,p=y.controls&&y.controls.left,i=b.x,f=b.y,s=(d||b).x,l=(d||b).y,o=(p||y).x,c=(p||y).y,u=y.x,h=y.y,d&&b._relative&&(s+=b.x,l+=b.y),p&&y._relative&&(o+=y.x,c+=y.y),r=e.Utils.getPointOnCubicBezier(t,i,s,o,u),a=e.Utils.getPointOnCubicBezier(t,f,l,c,h),_.isObject(n)?(n.x=r,n.y=a,n):new e.Vector(r,a))},plot:function(){if(this.curved)return e.Utils.getCurveFromPoints(this._vertices,this.closed),this;for(var t=0;t<this._vertices.length;t++)this._vertices[t]._command=t===0?e.Commands.move:e.Commands.line;return this},subdivide:function(t){this._update();var n=this.vertices.length-1,r=this.vertices[n],i=this._closed||this.vertices[n]._command===e.Commands.close,s=[];return _.each(this.vertices,function(o,u){if(u<=0&&!i){r=o;return}if(o.command===e.Commands.move){s.push(new e.Anchor(r.x,r.y)),u>0&&(s[s.length-1].command=e.Commands.line),r=o;return}var f=a(o,r,t);s=s.concat(f),_.each(f,function(t,n){n<=0&&r.command===e.Commands.move?t.command=e.Commands.move:t.command=e.Commands.line}),u>=n&&(this._closed&&this._automatic?(r=o,f=a(o,r,t),s=s.concat(f),_.each(f,function(t,n){n<=0&&r.command===e.Commands.move?t.command=e.Commands.move:t.command=e.Commands.line})):i&&s.push(new e.Anchor(o.x,o.y)),s[s.length-1].command=i?e.Commands.close:e.Commands.line),r=o},this),this._automatic=!1,this._curved=!1,this.vertices=s,this},_updateLength:function(t){this._update();var n=this.vertices.length-1,r=this.vertices[n],i=this._closed||this.vertices[n]._command===e.Commands.close,s=0;return _.isUndefined(this._lengths)&&(this._lengths=[]),_.each(this.vertices,function(o,a){if(a<=0&&!i||o.command===e.Commands.move){r=o,this._lengths[a]=0;return}this._lengths[a]=u(o,r,t),s+=this._lengths[a],a>=n&&i&&(r=o,this._lengths[a+1]=u(o,r,t),s+=this._lengths[a+1]),r=o},this),this._length=s,this},_update:function(){if(this._flagVertices){var t=this.vertices.length,n=t-1,i,s=r(this._beginning*n),o=r(this._ending*n);this._vertices.length=0;for(var u=s;u<o+1;u++)i=this.vertices[u],this._vertices.push(i);this._automatic&&this.plot()}return e.Shape.prototype._update.call(this),this},flagReset:function(){return this._flagVertices=this._flagFill=this._flagStroke=this._flagLinewidth=this._flagOpacity=this._flagVisible=this._flagCap=this._flagJoin=this._flagMiter=this._flagClip=!1,e.Shape.prototype.flagReset.call(this),this}}),o.MakeObservable(o.prototype)}(Two),function(e){var t=Math.min,n=Math.max,r=e.Group=function(){e.Shape.call(this,!0),this._renderer.type="group",this.additions=[],this.subtractions=[],this.children={}};_.extend(r,{MakeObservable:function(t){var n=e.Polygon.Properties.slice(0),i=_.indexOf(n,"opacity");i>=0&&(n.splice(i,1),Object.defineProperty(t,"opacity",{get:function(){return this._opacity},set:function(e){this._opacity=e,this._flagOpacity=!0}})),e.Shape.MakeObservable(t),r.MakeGetterSetters(t,n),Object.defineProperty(t,"mask",{get:function(){return this._mask},set:function(e){this._mask=e,this._flagMask=!0,e.clip||(e.clip=!0)}})},MakeGetterSetters:function(e,t){_.isArray(t)||(t=[t]),_.each(t,function(t){r.MakeGetterSetter(e,t)})},MakeGetterSetter:function(e,t){var n="_"+t;Object.defineProperty(e,t,{get:function(){return this[n]},set:function(e){this[n]=e,_.each(this.children,function(n){n[t]=e})}})}}),_.extend(r.prototype,e.Shape.prototype,{_flagAdditions:!1,_flagSubtractions:!1,_flagOpacity:!0,_flagMask:!1,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,_mask:null,clone:function(e){e=e||this.parent;var t=new r;e.add(t);var n=_.map(this.children,function(e){return e.clone(t)});return t.translation.copy(this.translation),t.rotation=this.rotation,t.scale=this.scale,t},toObject:function(){var e={children:{},translation:this.translation.toObject(),rotation:this.rotation,scale:this.scale};return _.each(this.children,function(t,n){e.children[n]=t.toObject()},this),e},corner:function(){var e=this.getBoundingClientRect(!0),t={x:e.left,y:e.top};return _.each(this.children,function(e){e.translation.subSelf(t)}),this},center:function(){var e=this.getBoundingClientRect(!0);return e.centroid={x:e.left+e.width/2,y:e.top+e.height/2},_.each(this.children,function(t){t.translation.subSelf(e.centroid)}),this},getById:function(e){var t=function(e,n){if(e.id===n)return e;for(var r in e.children){var i=t(e.children[r],n);if(i)return i}};return t(this,e)||null},getByClassName:function(e){var t=[],n=function(e,r){e.classList.indexOf(r)!=-1&&t.push(e);for(var i in e.children)n(e.children[i],r);return t};return n(this,e)},getByType:function(t){var n=[],r=function(t,i){for(var s in t.children)t.children[s]instanceof i?n.push(t.children[s]):t.children[s]instanceof e.Group&&r(t.children[s],i);return n};return r(this,t)},add:function(e){var t=arguments.length,n=this.children,r=this.parent,i=this.additions,s,o,u;return _.isArray(e)||(e=_.toArray(arguments)),_.each(e,function(e){if(!e)return;s=e.id,o=e.parent,_.isUndefined(n[s])&&(o&&(delete o.children[s],u=_.indexOf(o.additions,s),u>=0&&o.additions.splice(u,1)),n[s]=e,e.parent=this,i.push(s),this._flagAdditions=!0)},this),this},remove:function(e){var t=arguments.length,n=this.children,r=this.parent,i=this.subtractions,s,o,u,a;return t<=0&&r?(r.remove(this),this):(_.isArray(e)||(e=_.toArray(arguments)),_.each(e,function(e){s=e.id,a=e.children,o=e.parent;if(!(s in n))return;delete n[s],delete e.parent,u=_.indexOf(o.additions,s),u>=0&&o.additions.splice(u,1),i.push(s),this._flagSubtractions=!0},this),this)},getBoundingClientRect:function(){var e;this._update(!0);var r=Infinity,i=-Infinity,s=Infinity,o=-Infinity;return _.each(this.children,function(u){e=u.getBoundingClientRect();if(!_.isNumber(e.top)||!_.isNumber(e.left)||!_.isNumber(e.right)||!_.isNumber(e.bottom))return;s=t(e.top,s),r=t(e.left,r),i=n(e.right,i),o=n(e.bottom,o)},this),{top:s,left:r,right:i,bottom:o,width:i-r,height:o-s}},noFill:function(){return _.each(this.children,function(e){e.noFill()}),this},noStroke:function(){return _.each(this.children,function(e){e.noStroke()}),this},subdivide:function(){var e=arguments;return _.each(this.children,function(t){t.subdivide.apply(t,e)}),this},flagReset:function(){return this._flagAdditions&&(this.additions.length=0,this._flagAdditions=!1),this._flagSubtractions&&(this.subtractions.length=0,this._flagSubtractions=!1),this._flagMask=this._flagOpacity=!1,e.Shape.prototype.flagReset.call(this),this}}),r.MakeObservable(r.prototype)}(Two),function(){}.call(this);